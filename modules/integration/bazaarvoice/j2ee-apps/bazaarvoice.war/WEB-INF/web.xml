<?xml version="1.0" encoding="UTF-8"?>

<web-app xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
					xmlns="http://java.sun.com/xml/ns/javaee"
					xmlns:web="http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"
					xsi:schemaLocation="http://java.sun.com/xml/ns/javaee
					http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd" id="WebApp_ID" version="2.5">


	<!-- You must include a display name with the web application.  If you do not then when 
		you run your web application on JBoss (or other app server) you will be graced with 
		a NullPointerException from within the NucleusServlet
		
		java.lang.NullPointerException
		atg.servlet.NameContextManager.initializeSessionNameContext(NameContextManager.java:504)
		atg.taglib.dspjsp.Utils.checkParentSessionNameContext(Unknown Source)
		atg.filter.dspjsp.PageFilter.doFilter(Unknown Source)
		org.jboss.web.tomcat.filters.ReplyHeaderFilter.doFilter(ReplyHeaderFilter.java:75)
	-->
	<display-name>BazaarVoice</display-name>

	<!-- FOR APPSERVERS OTHER THAN DAS -->
	<!-- This setting tells JBoss that it needs to manage session replication.  If you 
		deploy this web application on a non-farmed JBoss server you will see this 
		error message in the server console:
		
		13:04:35,751 ERROR [JBossCacheManager] JBossCacheService to Tomcat clustering not found
		13:04:35,751 ERROR [TomcatDeployer] Failed to setup clustering, clustering disabled       
		
		<distributable/>
	-->


	<!-- FOR APPSERVERS OTHER THAN DAS -->
	<!-- 
		This is the name/value of the "parent web application", i.e. the name
		of a web application, which has a SessionNameContextServlet defined in it
		that will define the session scope for this web application. 
		Setting this here allows the child application to share the same session 
		scope with the above application.  Meaning these two apps share session.
		The parent web application OOTB is DafEar.base.
	-->
	<context-param>
		<param-name>atg.session.parentContextName</param-name>
		<param-value>/dyn</param-value>
	</context-param>


	<!-- FOR APPSERVERS OTHER THAN DAS -->
	<context-param>
		<param-name>atg.dafear.bootstrapContextName</param-name>
		<param-value>/dyn</param-value>
	</context-param>


	<!--
		If context-root is set here, then ServletContextWebAppRegistry will use
		this setting as the context-root for this WebApp. This must match
		the context-root setting in application.xml.
	-->
	<context-param>
		<param-name>context-root</param-name>
		<param-value>bv</param-value>
	</context-param>

	<!-- FOR APPSERVERS OTHER THAN DAS -->
	<!-- 
		Called when a request is for a .jsp file, the PageFilter servlet is 
		the entry point into the DAF pipeline.  PageFilter calls 
		atg/dynamo/servlet/dafpipeline/DynamoHandler to start the DAF servlet 
		pipeline for JSP requests. The DAF servlet pipeline relies on JBoss 
		to handle the complete page compilation process.
	-->
	<filter>
		<filter-name>PageFilter</filter-name>
		<filter-class>atg.filter.dspjsp.PageFilter</filter-class>
	</filter>
	<filter-mapping>
		<filter-name>PageFilter</filter-name>
		<url-pattern>*.jsp</url-pattern>
	</filter-mapping>


	<!-- FOR APPSERVERS OTHER THAN DAS -->
	<!-- 
		This servlet must be defined in each web application which is designated
		as a "main" web application (i.e. its context name is the value of
		another web application's atg.session.parentContextName parameter).  
		
		If you are seeing this here then this web application is being designated as 
		a parent web app.  Which means it will not share session with another 
		web application; other web applications may look to it as a parent when 
		sharing sessions.  Ensure the atg.session.parentContextName is also set 
		to the context root of this web application.
		
		Only uncomment this if this web application is a parent web application.
		
		<servlet>
		<servlet-name>SessionNameContextServlet</servlet-name>
		<servlet-class>atg.nucleus.servlet.SessionNameContextServlet</servlet-class>
		</servlet>
	-->

	<!-- FOR APPSERVERS OTHER THAN DAS -->
	<!--
		To use ATG platform functionality, a Web application on a 3rd party application 
		server needs to start Nucleus by invoking NucleusSerlvet. This servlet does not 
		need to have any paths mapped to it, but must have the load-on-startup flag set 
		to 1 so that it runs before any other ATG component. The NucleusServlet creates 
		an instance of Nucleus and sets it as an attribute of the web application.
	-->
	<servlet>
		<servlet-name>NucleusServlet</servlet-name>
		<servlet-class>
			atg.nucleus.servlet.NucleusServlet
		</servlet-class>
		<load-on-startup>1</load-on-startup>
	</servlet>


	<!-- Servlets for cactus unit testing -->
	<!--
		<servlet>
		<servlet-name>ServletRedirector</servlet-name>
		<servlet-class>org.apache.cactus.server.ServletTestRedirector</servlet-class>
		</servlet>
		<servlet>
		<servlet-name>JspRedirector</servlet-name>
		<jsp-file>/test/jspRedirector.jsp</jsp-file>
		</servlet>
	-->


	<!-- FOR APPSERVERS OTHER THAN DAS -->
	<!-- For diagnostic purposes only  -->
	<servlet-mapping>
		<servlet-name>NucleusServlet</servlet-name>
		<url-pattern>/nucleus/*</url-pattern>
	</servlet-mapping>


	<!-- Servlet mappings for cactus unit testing -->
	<!--
		<servlet-mapping>
		<servlet-name>ServletRedirector</servlet-name>
		<url-pattern>/ServletRedirector.jsp</url-pattern>
		</servlet-mapping>
		<servlet-mapping>
		<servlet-name>JspRedirector</servlet-name>
		<url-pattern>/JspRedirector</url-pattern>
		</servlet-mapping>
	-->


	<welcome-file-list>
		<welcome-file>index.jsp</welcome-file>
	</welcome-file-list>


	<!-- the 404 page 
		<error-page>
		<error-code>404</error-code>
		<location>/error.jsp</location>
		</error-page>
	-->

	<!-- 
		For internal errors.  This should really never happen, but 
		just in case...  
		<error-page>
		<exception-type>java.lang.Exception</exception-type>
		<location>/error.jsp</location>
		</error-page>
	-->


  <!-- possible fix to bug 1877 you also have to go the admin console and check the 'SSL listen port enabled' checkbox -->
  <!--
  <security-constraint>
    <web-resource-collection>
        <web-resource-name>SSL Required</web-resource-name>
        <url-pattern>/checkout/*</url-pattern>
        <url-pattern>/account/*</url-pattern>
    </web-resource-collection>
    <user-data-constraint>
        <transport-guarantee>CONFIDENTIAL</transport-guarantee>
    </user-data-constraint>
  </security-constraint>
  -->

  <jsp-config>
    <jsp-property-group>
        <url-pattern>*.jsp</url-pattern>
        <page-encoding>UTF-8</page-encoding>
        <include-prelude>/sitewide/fragments/prelude.jspf</include-prelude>
        <trim-directive-whitespaces>true</trim-directive-whitespaces>
    </jsp-property-group>
  </jsp-config>
</web-app>
